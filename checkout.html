<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Checkout at GrimHide - Secure payment processing for your premium leather goods." />
  <title>Checkout - GrimHide</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/checkout.css">
</head>
<body>

   <!-- ============================
       Header
  ============================ -->
  <header>
    <nav class="nav" aria-label="Primary">
      <span class="brand"><span class="dot"></span> GrimHide</span>
        <ul class="desk-links">
        <li><a class="link" href="index.html">Home</a></li>
        <li><a class="link" href="products.html">Products</a></li>
        <li><a class="link" href="about.html">About</a></li>
        <li><a class="link" href="contact.html">Contact</a></li>
      </ul>
      <div class="search" role="search">
        <label for="q" class="sr-only">Search products</label>
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35m2.02-5.15a7.5 7.5 0 11-15 0 7.5 7.5 0 0115 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="q" type="search" placeholder="Search productsâ€¦" aria-label="Search products" />
      </div>
      <!-- Login Button Added Here -->
      <a href="login.html" class="pill login-link-button" aria-label="Login">
        <svg class="login-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M15 3H7a2 2 0 00-2 2v14a2 2 0 002 2h8m4-9l-4-4m4 4l-4 4m0 0V7a2 2 0 012-2h2a2 2 0 012 2v10a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="login-text">Login</span>
      </a>
      <!-- Cart Button -->
      <button class="pill cart-btn" id="openCart" aria-label="Open cart">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 3h2l.4 2M7 13h10l3-8H6.4M7 13L5.4 5M7 13l-2 7h14M10 21a1 1 0 100-2 1 1 0 000 2zm8 0a1 1 0 100-2 1 1 0 000 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Cart <span class="cart-count" id="cartCount">0</span>
      </button>
      <button class="hamburger" id="hamburger" aria-label="Toggle menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>
    </nav>
  </header>
  <!-- ============================
       Checkout Section
  ============================ -->
  <section class="section">
    <div class="checkout-container">
      <h1>Secure Checkout</h1>
      <p class="lead">Complete your order with confidence</p>
      
      <div class="checkout-layout">
        <!-- Checkout Form -->
        <div class="checkout-form">
          <form id="checkoutForm">
            <!-- Billing Information -->
            <div class="form-section">
              <h3><i class="fas fa-user"></i> Billing Information</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName">First Name *</label>
                  <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="form-group">
                  <label for="lastName">Last Name *</label>
                  <input type="text" id="lastName" name="lastName" required>
                </div>
              </div>
              <div class="form-group">
                <label for="email">Email Address *</label>
                <input type="email" id="email" name="email" required>
              </div>
              <div class="form-group">
                <label for="phone">Phone Number *</label>
                <input type="tel" id="phone" name="phone" required>
              </div>
            </div>

            <!-- Shipping Address -->
            <div class="form-section">
              <h3><i class="fas fa-truck"></i> Shipping Address</h3>
              <div class="form-group">
                <label for="address">Street Address *</label>
                <input type="text" id="address" name="address" required>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="city">City *</label>
                  <input type="text" id="city" name="city" required>
                </div>
                <div class="form-group">
                  <label for="zipCode">ZIP Code *</label>
                  <input type="text" id="zipCode" name="zipCode" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="country">Country *</label>
                  <select id="country" name="country" required>
                    <option value="">Select Country</option>
                    <option value="pakistan" selected>Pakistan</option>
                    <option value="usa">United States</option>
                    <option value="uk">United Kingdom</option>
                    <option value="uae">UAE</option>
                    <option value="canada">Canada</option>
                    <option value="australia">Australia</option>
                  </select>
                </div>
                <div class="form-group" id="stateGroup" style="display: none;">
                  <label for="state">State *</label>
                  <select id="state" name="state">
                    <option value="">Select State</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Payment Method -->
            <div class="form-section">
              <h3><i class="fas fa-credit-card"></i> Payment Method</h3>
              <div class="payment-methods">
                <!-- Removed Cash on Delivery -->
                <div class="payment-method selected" data-method="card">
                  <i class="fas fa-credit-card"></i>
                  <div>Credit Card</div>
                </div>
                <div class="payment-method" data-method="bank">
                  <i class="fas fa-university"></i>
                  <div>Bank Transfer</div>
                </div>
              </div>
              
              <!-- Credit Card Details -->
              <div id="cardDetails" style="display: block;">
                <div class="form-group">
                  <label for="cardNumber">Card Number *</label>
                  <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" required>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="expiry">Expiry Date *</label>
                    <input type="text" id="expiry" name="expiry" placeholder="MM/YY" required>
                  </div>
                  <div class="form-group">
                    <label for="cvv">CVV *</label>
                    <input type="text" id="cvv" name="cvv" placeholder="123" required>
                  </div>
                </div>
                <div class="form-group">
                  <label for="cardName">Name on Card *</label>
                  <input type="text" id="cardName" name="cardName" required>
                </div>
              </div>

              <!-- Bank Transfer Details -->
              <div id="bankDetails">
                <!-- Bank information commented out as requested -->
                
                <div class="bank-info-card">
                  <h4><i class="fas fa-building"></i> Bank Information</h4>
                  <div class="bank-detail-row">
                    <span class="bank-label">Bank Name:</span>
                    <span class="bank-value">[BANK_NAME]</span>
                  </div>
                  <div class="bank-detail-row">
                    <span class="bank-label">Account Holder:</span>
                    <span class="bank-value">[ACCOUNT_HOLDER]</span>
                  </div>
                  <div class="bank-detail-row">
                    <span class="bank-label">Account Number:</span>
                    <span class="bank-value">[ACCOUNT_NUMBER]</span>
                  </div>
                  <div class="bank-detail-row">
                    <span class="bank-label">IBAN:</span>
                    <span class="bank-value">[IBAN]</span>
                  </div>
                  <div class="bank-detail-row">
                    <span class="bank-label">Branch Code:</span>
                    <span class="bank-value">[BRANCH_CODE]</span>
                  </div>
                  <div class="bank-detail-row">
                    <span class="bank-label">Branch Name:</span>
                    <span class="bank-value">[BRANCH_NAME]</span>
                  </div>
                </div>
                

                <div class="bank-info-card">
                  <h4><i class="fas fa-info-circle"></i> Payment Instructions</h4>
                  <div class="bank-detail-row">
                    <span class="bank-label">Total Amount:</span>
                    <span class="bank-value" id="bankTransferAmount">$0.00</span>
                  </div>
                  <div class="bank-detail-row">
                    <span class="bank-label">Reference:</span>
                    <span class="bank-value">GH-ORDER-[ORDER_NUMBER]</span>
                  </div>
                </div>

                <!-- Screenshot Upload Section -->
                <div class="form-group">
                  <label for="paymentScreenshot">Payment Screenshot *</label>
                  <input type="file" id="paymentScreenshot" name="paymentScreenshot" accept="image/*" required>
                  <p class="muted" style="margin-top: 8px; font-size: 0.9rem;">
                    Please upload a clear screenshot of your payment confirmation.
                    <br><strong>Note:</strong> Your order will not be processed until we verify your payment.
                  </p>
                </div>

                <div class="important-note">
                  <h5><i class="fas fa-exclamation-triangle"></i> Important Notes</h5>
                  <ul>
                    <li>After making the transfer, please upload the receipt here</li>
                    <li>Include your order number in the image or email subject</li>
                    <li>Allow 1-2 business days for payment verification</li>
                    <li>Your order will be processed once payment is confirmed</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Order Notes -->
            <div class="form-section">
              <h3><i class="fas fa-sticky-note"></i> Order Notes (Optional)</h3>
              <div class="form-group">
                <textarea id="orderNotes" name="orderNotes" rows="4" placeholder="Any special instructions for your order..."></textarea>
              </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="form-section">
              <label class="checkbox-label">
                <input type="checkbox" id="terms" name="terms" required>
                <span>I agree to the <a href="#" style="color: var(--brand);">Terms & Conditions</a> and <a href="#" style="color: var(--brand);">Privacy Policy</a> *</span>
              </label>
            </div>

            <!-- Place Order Button -->
            <button type="button" class="place-order-btn" id="placeOrderBtn">
              <i class="fas fa-lock"></i> Place Order - <span id="orderTotal">$0.00</span>
            </button>
          </form>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <h3>
            Order Summary
            <a href="cart.html" class="edit-cart">
              <i class="fas fa-edit"></i> Edit Cart
            </a>
          </h3>
          <div id="orderItems">
            <!-- Items will be loaded here -->
            <p class="empty-cart-message">No items in cart</p>
          </div>
          
          <div class="summary-item">
            <span>Subtotal</span>
            <span id="summarySubtotal">$0.00</span>
          </div>
          <div class="summary-item">
            <span>Shipping</span>
            <span id="shippingCost">Free</span>
          </div>
          <div class="summary-item">
            <span>Tax (8%)</span>
            <span id="summaryTax">$0.00</span>
          </div>
          <div class="summary-item summary-total">
            <span>Total</span>
            <span id="summaryTotal">$0.00</span>
          </div>
          
          <div class="secure-note">
            <i class="fas fa-shield-alt"></i>
            <div>Secure SSL Encryption â€¢ 30-day Returns</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ============================
       Footer
  ============================ -->
  <footer>
    <div class="foot">
      <div>
        <h4>About GrimHide</h4>
        <p class="muted">Premium leather goods engineered for durability and design. Our artisans craft every stitch with precision so you can move with confidence.</p>
      </div>
      <div>
        <h4>Links</h4>
        <ul class="footer-links">
          <li><a href="index.html#home">Home</a></li>
          <li><a href="products.html">Products</a></li>
          <li><a href="index.html#about">About</a></li>
          <li><a href="index.html#contact">Contact</a></li>
        </ul>
      </div>
      <div id="contact">
        <h4>Contact</h4>
        <p class="muted">support@grimhide.store<br/>+92 305 8754141</p>
        <div class="social">
          <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
          <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
          <a href="#" aria-label="TikTok"><i class="fab fa-tiktok"></i></a>
        </div>
      </div>
    </div>
    <div class="copy">Â© 2025 GrimHide. All rights reserved.</div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // âœ… FIXED: Same CART_KEY as cart.html
      const CART_KEY = 'grimhide_cart_v1';
      let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
      
      // DOM Elements
      const orderItemsDiv = document.getElementById('orderItems');
      const summarySubtotal = document.getElementById('summarySubtotal');
      const summaryTax = document.getElementById('summaryTax');
      const shippingCost = document.getElementById('shippingCost');
      const summaryTotal = document.getElementById('summaryTotal');
      const orderTotal = document.getElementById('orderTotal');
      const placeOrderBtn = document.getElementById('placeOrderBtn');
      const cartCountEl = document.getElementById('cartCount');
      const termsCheckbox = document.getElementById('terms');
      const countrySelect = document.getElementById('country');
      const stateGroup = document.getElementById('stateGroup');
      const stateSelect = document.getElementById('state');
      const bankTransferAmount = document.getElementById('bankTransferAmount');
      
      // US States from Knowledge Base
      const usStates = [
        "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", 
        "Connecticut", "District of Columbia", "Florida", "Georgia", "Hawaii", 
        "Idaho", "Illinois", "Indiana", "Kansas", "Kentucky", "Louisiana", 
        "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", 
        "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", 
        "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", 
        "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", 
        "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", 
        "Washington", "West Virginia", "Wisconsin", "Wyoming"
      ];
      
      // Money formatter
      const money = (n) => `$${parseFloat(n).toFixed(2)}`;
      
      // âœ… FIXED: Update order summary with correct property names
      function updateOrderSummary() {
        // Always fetch fresh data from localStorage
        cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
        
        if (cart.length === 0) {
          orderItemsDiv.innerHTML = '<p class="empty-cart-message">No items in cart</p>';
          summarySubtotal.textContent = '$0.00';
          summaryTax.textContent = '$0.00';
          shippingCost.textContent = 'Free';
          summaryTotal.textContent = '$0.00';
          orderTotal.textContent = '$0.00';
          if (bankTransferAmount) bankTransferAmount.textContent = '$0.00';
          cartCountEl.textContent = '0';
          return;
        }
        
        let orderHTML = '';
        let subtotal = 0;
        
        // âœ… Use correct property names from cart.html (id, name, price, qty, img)
        cart.forEach(item => {
          const itemTotal = parseFloat(item.price) * parseInt(item.qty);
          subtotal += itemTotal;
          
          orderHTML += `
            <div class="cart-item-mini">
              <div class="cart-item-image">
                <img src="${item.img}" alt="${item.name}" loading="lazy">
              </div>
              <div class="cart-item-details">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-variant">Quantity: ${item.qty}</div>
                <div class="cart-item-price">${item.qty} Ã— ${money(item.price)} = ${money(itemTotal)}</div>
              </div>
            </div>
          `;
        });
        
        orderItemsDiv.innerHTML = orderHTML;
        
        // Calculate SAME totals as cart page
        const tax = subtotal * 0.08; // 8% tax
        const shipping = subtotal >= 200 ? 0 : 15.00; // Free shipping over $200
        const total = subtotal + tax + shipping;
        
        // Show SAME prices as cart page
        summarySubtotal.textContent = money(subtotal);
        summaryTax.textContent = money(tax);
        shippingCost.textContent = shipping === 0 ? 'Free' : money(shipping);
        summaryTotal.textContent = money(total);
        orderTotal.textContent = money(total);
        if (bankTransferAmount) bankTransferAmount.textContent = money(total);
        
        // Update cart count in header (SAME as cart page)
        const count = cart.reduce((sum, item) => sum + parseInt(item.qty), 0);
        cartCountEl.textContent = count;
      }
      
      // âœ… Real-time storage event listener (updates when cart changes elsewhere)
      window.addEventListener('storage', function(e) {
        if (e.key === CART_KEY) {
          try {
            cart = JSON.parse(e.newValue || '[]');
            updateOrderSummary(); // âœ… Update instantly when cart changes
          } catch (error) {
            console.error('Error parsing cart ', error);
            cart = [];
            updateOrderSummary();
          }
        }
      });

      // âœ… Add visibility change listener to update cart when user returns to tab
      document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
          updateOrderSummary();
        }
      });

      // âœ… Add focus event listener to update cart when window gains focus
      window.addEventListener('focus', function() {
        updateOrderSummary();
      });
      
      // Country selection to show/hide state dropdown
      if (countrySelect) {
        countrySelect.addEventListener('change', function() {
          if (this.value === 'usa') {
            stateGroup.style.display = 'block';
            
            // Populate states dropdown
            stateSelect.innerHTML = '<option value="">Select State</option>';
            usStates.forEach(state => {
              const option = document.createElement('option');
              option.value = state.toLowerCase().replace(/\s+/g, '-');
              option.textContent = state;
              stateSelect.appendChild(option);
            });
          } else {
            stateGroup.style.display = 'none';
            stateSelect.innerHTML = '<option value="">Select State</option>';
          }
        });
      }
      
      // Payment method selection
      document.querySelectorAll('.payment-method').forEach(method => {
        method.addEventListener('click', function() {
          document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
          this.classList.add('selected');
          
          const selectedMethod = this.dataset.method;
          const cardDetails = document.getElementById('cardDetails');
          const bankDetails = document.getElementById('bankDetails');
          
          // Hide all payment details
          if (cardDetails) cardDetails.style.display = 'none';
          if (bankDetails) bankDetails.style.display = 'none';
          
          // Show selected payment details
          if (selectedMethod === 'card' && cardDetails) {
            cardDetails.style.display = 'block';
          } else if (selectedMethod === 'bank' && bankDetails) {
            bankDetails.style.display = 'block';
          }
        });
      });
      
      // Place Order Button Handler
      if (placeOrderBtn) {
        placeOrderBtn.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Check if cart is empty
          if (cart.length === 0) {
            showNotification('Your cart is empty! Please add items before checkout.');
            return;
          }
          
          // Form Validation
          if (!validateForm()) {
            return;
          }
          
          // Check terms agreement
          if (!termsCheckbox.checked) {
            showNotification('Please agree to the Terms & Conditions and Privacy Policy');
            termsCheckbox.focus();
            return;
          }
          
          // Show Loading State
          const originalHTML = placeOrderBtn.innerHTML;
          placeOrderBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing Order...';
          placeOrderBtn.disabled = true;
          
          // âœ… Generate Order Number
          const orderNumber = `GH-${new Date().getFullYear()}-${Math.floor(100000 + Math.random() * 900000)}`;
          
          // Get form data
          const formData = new FormData(document.getElementById('checkoutForm'));
          const customerInfo = {};
          for (let [key, value] of formData.entries()) {
            // Handle file inputs separately
            if (key === 'paymentScreenshot' && value instanceof File) {
              // For now, we'll just store the file name
              // In a real application, you would upload the file to a server
              customerInfo[key] = value.name;
            } else {
              customerInfo[key] = value;
            }
          }
          
          // âœ… Save Order Data (Pending Status)
          const orderData = {
            orderNumber: orderNumber,
            date: new Date().toISOString(),
            items: cart,
            totals: {
              subtotal: summarySubtotal.textContent,
              tax: summaryTax.textContent,
              shipping: shippingCost.textContent,
              total: summaryTotal.textContent
            },
            customerInfo: customerInfo,
            paymentMethod: document.querySelector('.payment-method.selected').dataset.method,
            status: 'pending', // âœ… Pending status
            paymentStatus: 'pending' // âœ… Pending payment status
          };
          
          try {
            // âœ… Store Pending Order Data
            localStorage.setItem('pendingOrder', JSON.stringify(orderData));
            
            // âœ… Clear Cart
            localStorage.removeItem(CART_KEY);
            
            // âœ… Update Cart Count in Header
            cartCountEl.textContent = '0';
            
            // âœ… Redirect to Order Confirmation Page (Pending Status)
            // Use a small delay to ensure localStorage is updated before redirecting
            setTimeout(() => {
              window.location.href = 'order-confirmation.html';
            }, 500);
          } catch (error) {
            console.error('Error saving order:', error);
            showNotification('There was an error processing your order. Please try again.');
            // Reset button state
            placeOrderBtn.innerHTML = originalHTML;
            placeOrderBtn.disabled = false;
          }
        });
      }
      
      // Form Validation Function
      function validateForm() {
        const requiredFields = document.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
          if (!field.value.trim()) {
            field.classList.add('error');
            isValid = false;
          } else {
            field.classList.remove('error');
          }
        });
        
        // Email validation
        const emailField = document.getElementById('email');
        if (emailField && emailField.value) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(emailField.value)) {
            emailField.classList.add('error');
            showNotification('Please enter a valid email address');
            isValid = false;
          } else {
            emailField.classList.remove('error');
          }
        }
        
        // Phone validation (simple)
        const phoneField = document.getElementById('phone');
        if (phoneField && phoneField.value) {
          const phoneRegex = /^[0-9+\-\s()]+$/;
          if (!phoneRegex.test(phoneField.value)) {
            phoneField.classList.add('error');
            showNotification('Please enter a valid phone number');
            isValid = false;
          } else {
            phoneField.classList.remove('error');
          }
        }
        
        // Credit card validation if credit card is selected
        const selectedPayment = document.querySelector('.payment-method.selected');
        if (selectedPayment && selectedPayment.dataset.method === 'card') {
          const cardNumber = document.getElementById('cardNumber');
          const expiry = document.getElementById('expiry');
          const cvv = document.getElementById('cvv');
          const cardName = document.getElementById('cardName');
          
          if (cardNumber && !/^\d{4} \d{4} \d{4} \d{4}$/.test(cardNumber.value)) {
            cardNumber.classList.add('error');
            showNotification('Please enter a valid 16-digit card number');
            isValid = false;
          }
          
          if (expiry && !/^\d{2}\/\d{2}$/.test(expiry.value)) {
            expiry.classList.add('error');
            showNotification('Please enter a valid expiry date (MM/YY)');
            isValid = false;
          }
          
          if (cvv && !/^\d{3,4}$/.test(cvv.value)) {
            cvv.classList.add('error');
            showNotification('Please enter a valid CVV (3-4 digits)');
            isValid = false;
          }
          
          if (cardName && !cardName.value.trim()) {
            cardName.classList.add('error');
            showNotification('Please enter the name on the card');
            isValid = false;
          }
        }
        
        // âœ… Validate payment screenshot for bank transfer
        if (selectedPayment && selectedPayment.dataset.method === 'bank') {
          const screenshot = document.getElementById('paymentScreenshot');
          if (!screenshot.files.length) {
            screenshot.classList.add('error');
            showNotification('Please upload a payment screenshot');
            isValid = false;
          } else {
            screenshot.classList.remove('error');
          }
        }
        
        if (!isValid) {
          showNotification('Please fill in all required fields correctly');
        }
        
        return isValid;
      }
      
      // Show notification
      function showNotification(message) {
        // Remove existing toast
        const existingToast = document.querySelector('.toast');
        if (existingToast) existingToast.remove();
        
        // Create notification element
        const notification = document.createElement('div');
        notification.className = 'toast';
        notification.innerHTML = `
          <i class="fas fa-info-circle"></i>
          <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
          notification.classList.add('show');
        }, 10);
        
        // Auto remove
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 3000);
        }, 3000);
      }
      
      // Format credit card inputs
      const cardNumber = document.getElementById('cardNumber');
      const expiry = document.getElementById('expiry');
      const cvv = document.getElementById('cvv');
      
      if (cardNumber) {
        cardNumber.addEventListener('input', function() {
          let value = this.value.replace(/\D/g, '');
          let formatted = '';
          for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) formatted += ' ';
            formatted += value[i];
          }
          this.value = formatted.substring(0, 19);
        });
      }
      
      if (expiry) {
        expiry.addEventListener('input', function() {
          let value = this.value.replace(/\D/g, '');
          if (value.length >= 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
          }
          this.value = value.substring(0, 5);
        });
      }
      
      if (cvv) {
        cvv.addEventListener('input', function() {
          this.value = this.value.replace(/\D/g, '').substring(0, 4);
        });
      }
      
      // Mobile menu toggle
      const hamburger = document.getElementById('hamburger');
      const mnav = document.getElementById('mnav');
      
      if (hamburger && mnav) {
        hamburger.addEventListener('click', () => {
          const open = mnav.classList.toggle('open');
          hamburger.setAttribute('aria-expanded', String(open));
        });
      }
      
      // âœ… Initialize order summary with real cart data
      updateOrderSummary();
    });
  </script>
  <script>
document.addEventListener('DOMContentLoaded', function() {
  // ... (other code remains the same)

  // Form Validation Function - UPDATED VERSION
  function validateForm() {
    // Reset all error states first
    document.querySelectorAll('.form-group input, .form-group select, .form-group textarea').forEach(field => {
      field.classList.remove('error');
    });
    
    let isValid = true;
    
    // Check all required fields
    const requiredFields = document.querySelectorAll('[required]');
    requiredFields.forEach(field => {
      if (!field.value || field.value.trim() === '') {
        field.classList.add('error');
        isValid = false;
      }
    });
    
    // Email validation
    const emailField = document.getElementById('email');
    if (emailField && emailField.value) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(emailField.value)) {
        emailField.classList.add('error');
        showNotification('Please enter a valid email address');
        isValid = false;
      }
    }
    
    // Phone validation (simple)
    const phoneField = document.getElementById('phone');
    if (phoneField && phoneField.value) {
      const phoneRegex = /^[0-9+\-\s()]+$/;
      if (!phoneRegex.test(phoneField.value)) {
        phoneField.classList.add('error');
        showNotification('Please enter a valid phone number');
        isValid = false;
      }
    }
    
    // Credit card validation if credit card is selected
    const selectedPayment = document.querySelector('.payment-method.selected');
    if (selectedPayment && selectedPayment.dataset.method === 'card') {
      const cardNumber = document.getElementById('cardNumber');
      const expiry = document.getElementById('expiry');
      const cvv = document.getElementById('cvv');
      const cardName = document.getElementById('cardName');
      
      if (cardNumber && (!cardNumber.value || !/^\d{4} \d{4} \d{4} \d{4}$/.test(cardNumber.value))) {
        cardNumber.classList.add('error');
        showNotification('Please enter a valid 16-digit card number');
        isValid = false;
      }
      
      if (expiry && (!expiry.value || !/^\d{2}\/\d{2}$/.test(expiry.value))) {
        expiry.classList.add('error');
        showNotification('Please enter a valid expiry date (MM/YY)');
        isValid = false;
      }
      
      if (cvv && (!cvv.value || !/^\d{3,4}$/.test(cvv.value))) {
        cvv.classList.add('error');
        showNotification('Please enter a valid CVV (3-4 digits)');
        isValid = false;
      }
      
      if (cardName && (!cardName.value || cardName.value.trim() === '')) {
        cardName.classList.add('error');
        showNotification('Please enter the name on the card');
        isValid = false;
      }
    }
    
    // Validate payment screenshot for bank transfer
    if (selectedPayment && selectedPayment.dataset.method === 'bank') {
      const screenshot = document.getElementById('paymentScreenshot');
      if (screenshot && (!screenshot.files || screenshot.files.length === 0)) {
        screenshot.classList.add('error');
        showNotification('Please upload a payment screenshot');
        isValid = false;
      }
    }
    
    // Special validation for country/state
    const countrySelect = document.getElementById('country');
    const stateGroup = document.getElementById('stateGroup');
    const stateSelect = document.getElementById('state');
    
    if (countrySelect && countrySelect.value === 'usa') {
      if (stateGroup && stateGroup.style.display !== 'none') {
        if (stateSelect && (!stateSelect.value || stateSelect.value.trim() === '')) {
          stateSelect.classList.add('error');
          showNotification('Please select a state');
          isValid = false;
        }
      }
    }
    
    if (!isValid) {
      showNotification('Please fill in all required fields correctly');
    }
    
    return isValid;
  }
  
  // ... (rest of the code remains the same)
});
</script>
  <script src="js/main.js"></script>

</body>
</html>